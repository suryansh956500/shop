 // Order Form Setup
function setupOrderForm() {
  const orderForm = document.getElementById('orderForm');
  orderForm.addEventListener('submit', function(e) {
    e.preventDefault();
    submitOrder();
  });
}

function submitOrder() {
  const name = document.getElementById('customerName').value.trim();
  const phoneStr = document.getElementById('customerPhone').value.trim();
  const address = document.getElementById('customerAddress').value.trim();
  const items = document.getElementById('orderItems').value.trim();

  // Validate all fields
  if (!name || !phoneStr || !address || !items) {
    showNotification('âŒ à¤¸à¤­à¥€ à¤«à¥€à¤²à¥à¤¡ à¤­à¤°à¥‡à¤‚!', 'error');
    return;
  }

  // Validate exactly 10-digit phone number (string)
  if (!/^[0-9]{10}$/.test(phoneStr)) {
    showNotification('âŒ à¤«à¥‹à¤¨ à¤¨à¤‚à¤¬à¤° 10 à¤…à¤‚à¤• à¤•à¤¾ à¤¹à¥‹à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤!', 'error');
    document.getElementById('customerPhone').focus();
    return;
  }

  if (!selectedPaymentMethod) {
    showNotification('âŒ à¤ªà¥‡à¤®à¥‡à¤‚à¤Ÿ à¤µà¤¿à¤§à¤¿ à¤šà¥à¤¨à¥‡à¤‚!', 'error');
    return;
  }

  if (selectedPaymentMethod === 'upi') {
    if (!selectedUpiMethod) {
      showNotification('âŒ UPI à¤µà¤¿à¤§à¤¿ à¤šà¥à¤¨à¥‡à¤‚ (QR à¤¯à¤¾ Manual)!', 'error');
      return;
    }
    const proofFiles = document.getElementById('paymentProof').files;
    if (proofFiles.length === 0) {
      showNotification('âŒ à¤ªà¥‡à¤®à¥‡à¤‚à¤Ÿ à¤•à¥€ à¤°à¤¸à¥€à¤¦ à¤…à¤ªà¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚!', 'error');
      return;
    }
  }

  const order = {
    id: Date.now(),
    name,
    phone: phoneStr,         // string à¤¹à¥€ use à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ
    address,
    items,
    paymentMethod: selectedPaymentMethod,
    upiMethod: selectedUpiMethod,
    date: new Date().toLocaleString('hi-IN')
  };

  // Save locally
  orders.push(order);
  localStorage.setItem('orders', JSON.stringify(orders));

  // Send WhatsApp messages (string concat)
  sendConfirmationMessages(order);

  // Reset form
  orderForm.reset();
  selectedPaymentMethod = null;
  selectedUpiMethod = null;
  qrCodeGenerated = false;
  document.querySelectorAll('.payment-option, .upi-method').forEach(el => el.classList.remove('selected'));
  document.getElementById('upiSection').classList.remove('show');
  document.getElementById('codSection').classList.remove('show');
  document.getElementById('qrCodeContainer').style.display = 'none';
  document.getElementById('manualUpiContainer').style.display = 'none';
  document.getElementById('screenshotUpload').style.display = 'none';

  showNotification('âœ… à¤‘à¤°à¥à¤¡à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤! WhatsApp à¤“à¤ªà¤¨ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...', 'success');
}

function sendConfirmationMessages(order) {
  const whatsappNumber = '9838660814';  // correct number as string

  const paymentInfo = order.paymentMethod === 'upi'
    ? `UPI (${order.upiMethod})`
    : 'Cash on Delivery';

  const customerMsg =
    `âœ… ORDER CONFIRMED! - SURYANSH STORE\n\n` +
    `à¤¨à¤¾à¤®: ${order.name}\n` +
    `à¤«à¥‹à¤¨: ${order.phone}\n` +
    `à¤ªà¤¤à¤¾: ${order.address}\n\n` +
    `à¤†à¤‡à¤Ÿà¤®à¥à¤¸:\n${order.items}\n\n` +
    `à¤ªà¥‡à¤®à¥‡à¤‚à¤Ÿ: ${paymentInfo}\n` +
    `à¤¦à¤¿à¤¨à¤¾à¤‚à¤•: ${order.date}\n\n` +
    `à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦!`;

  const storeMsg =
    `ðŸš¨ à¤¨à¤¯à¤¾ à¤‘à¤°à¥à¤¡à¤° à¤†à¤¯à¤¾!\n\n` +
    `ID: #${order.id}\n` +
    `à¤¨à¤¾à¤®: ${order.name}\n` +
    `à¤«à¥‹à¤¨: ${order.phone}\n` +
    `à¤ªà¤¤à¤¾: ${order.address}\n\n` +
    `à¤†à¤‡à¤Ÿà¤®à¥à¤¸:\n${order.items}\n\n` +
    `à¤ªà¥‡à¤®à¥‡à¤‚à¤Ÿ: ${paymentInfo}\n` +
    `à¤¦à¤¿à¤¨à¤¾à¤‚à¤•: ${order.date}\n\n` +
    `à¤•à¥ƒà¤ªà¤¯à¤¾ à¤­à¥‡à¤œ à¤¦à¥‡à¤‚à¥¤`;

  // Compose URLs using only string concatenation
  const customerUrl = 
    'https://wa.me/91' + order.phone +
    '?text=' + encodeURIComponent(customerMsg);

  const storeUrl = 
    'https://wa.me/91' + whatsappNumber +
    '?text=' + encodeURIComponent(storeMsg);

  window.open(customerUrl, '_blank');
  setTimeout(() => {
    window.open(storeUrl, '_blank');
  }, 1500);
}
