 // Order Form Setup
function setupOrderForm() {
  const orderForm = document.getElementById('orderForm');
  orderForm.addEventListener('submit', function(e) {
    e.preventDefault();
    submitOrder();
  });
}

function submitOrder() {
  const name = document.getElementById('customerName').value.trim();
  const phoneStr = document.getElementById('customerPhone').value.trim();
  const address = document.getElementById('customerAddress').value.trim();
  const items = document.getElementById('orderItems').value.trim();

  // Validate all fields
  if (!name || !phoneStr || !address || !items) {
    showNotification('❌ सभी फील्ड भरें!', 'error');
    return;
  }

  // Validate exactly 10-digit phone number (string)
  if (!/^[0-9]{10}$/.test(phoneStr)) {
    showNotification('❌ फोन नंबर 10 अंक का होना चाहिए!', 'error');
    document.getElementById('customerPhone').focus();
    return;
  }

  if (!selectedPaymentMethod) {
    showNotification('❌ पेमेंट विधि चुनें!', 'error');
    return;
  }

  if (selectedPaymentMethod === 'upi') {
    if (!selectedUpiMethod) {
      showNotification('❌ UPI विधि चुनें (QR या Manual)!', 'error');
      return;
    }
    const proofFiles = document.getElementById('paymentProof').files;
    if (proofFiles.length === 0) {
      showNotification('❌ पेमेंट की रसीद अपलोड करें!', 'error');
      return;
    }
  }

  const order = {
    id: Date.now(),
    name,
    phone: phoneStr,         // string ही use हो रहा है
    address,
    items,
    paymentMethod: selectedPaymentMethod,
    upiMethod: selectedUpiMethod,
    date: new Date().toLocaleString('hi-IN')
  };

  // Save locally
  orders.push(order);
  localStorage.setItem('orders', JSON.stringify(orders));

  // Send WhatsApp messages (string concat)
  sendConfirmationMessages(order);

  // Reset form
  orderForm.reset();
  selectedPaymentMethod = null;
  selectedUpiMethod = null;
  qrCodeGenerated = false;
  document.querySelectorAll('.payment-option, .upi-method').forEach(el => el.classList.remove('selected'));
  document.getElementById('upiSection').classList.remove('show');
  document.getElementById('codSection').classList.remove('show');
  document.getElementById('qrCodeContainer').style.display = 'none';
  document.getElementById('manualUpiContainer').style.display = 'none';
  document.getElementById('screenshotUpload').style.display = 'none';

  showNotification('✅ ऑर्डर प्राप्त! WhatsApp ओपन हो रहा है...', 'success');
}

function sendConfirmationMessages(order) {
  const whatsappNumber = '9838660814';  // correct number as string

  const paymentInfo = order.paymentMethod === 'upi'
    ? `UPI (${order.upiMethod})`
    : 'Cash on Delivery';

  const customerMsg =
    `✅ ORDER CONFIRMED! - SURYANSH STORE\n\n` +
    `नाम: ${order.name}\n` +
    `फोन: ${order.phone}\n` +
    `पता: ${order.address}\n\n` +
    `आइटम्स:\n${order.items}\n\n` +
    `पेमेंट: ${paymentInfo}\n` +
    `दिनांक: ${order.date}\n\n` +
    `धन्यवाद!`;

  const storeMsg =
    `🚨 नया ऑर्डर आया!\n\n` +
    `ID: #${order.id}\n` +
    `नाम: ${order.name}\n` +
    `फोन: ${order.phone}\n` +
    `पता: ${order.address}\n\n` +
    `आइटम्स:\n${order.items}\n\n` +
    `पेमेंट: ${paymentInfo}\n` +
    `दिनांक: ${order.date}\n\n` +
    `कृपया भेज दें।`;

  // Compose URLs using only string concatenation
  const customerUrl = 
    'https://wa.me/91' + order.phone +
    '?text=' + encodeURIComponent(customerMsg);

  const storeUrl = 
    'https://wa.me/91' + whatsappNumber +
    '?text=' + encodeURIComponent(storeMsg);

  window.open(customerUrl, '_blank');
  setTimeout(() => {
    window.open(storeUrl, '_blank');
  }, 1500);
}
